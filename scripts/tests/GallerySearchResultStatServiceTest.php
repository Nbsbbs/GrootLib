<?php

use Noobus\GrootLib\Entity\Config\ClickhouseConfig;
use Noobus\GrootLib\Statistics\Request\GallerySearchResultStatRequest;
use Noobus\GrootLib\Statistics\Service\GallerySearchResultStatService;
use Noobus\GrootLib\Storage\Clickhouse\ClientFactory;

require_once '../bootstrap.php';

$config = new ClickhouseConfig('127.0.0.1', '8123', 'test');
$clientFactory = new ClientFactory($config);

$service = new GallerySearchResultStatService($clientFactory);
$ids = [
    3662144,
    3399601,
    3617826,
    3331770,
    3642117,
    3605151,
    3328417,
    3415116,
    3655190,
    3510138,
    3660873,
    3614172,
    3630887,
    3646828,
    3368835,
    3611300,
    3621344,
    3577708,
    3437076,
    3592904,
    3491931,
    3396274,
    3510166,
    3662521,
    3548126,
    3460955,
    3614991,
    3335874,
    3382663,
    3553945,
    3642776,
    3648622,
    3377562,
    3471306,
    3333980,
    3658534,
    3545382,
    3477689,
    3674872,
    3333332,
    3569840,
    3558167,
    3658141,
    3664910,
    3330440,
    3435351,
    3370853,
    3448598,
    3350942,
    3361092,
    3350575,
    3369738,
    3673903,
    3396231,
    3345403,
    3350109,
    3499282,
    3384296,
    3644887,
    2910544,
    3345412,
    3425383,
    3576346,
    3605834,
    3338532,
    3477341,
    3561613,
    3602566,
    3336675,
    3616837,
    3350027,
    3658888,
    3576870,
    3657929,
    3325805,
    3647220,
    3675846,
    3581995,
    3328071,
    3312292,
    3339599,
    3658173,
    3646448,
    3341832,
    3346082,
    3669643,
    3617920,
    3609337,
    3654694,
    3660368,
    3469482,
    3650171,
    3320762,
    3583184,
    3323069,
    3547766,
    3491965,
    3333101,
    3679321,
    3337792,
    3511376,
    3569233,
    3563948,
    3644118,
    3590980,
    3665274,
    3447005,
    3332672,
    3603233,
    3341989,
    3352085,
    3526051,
    3642013,
    3326482,
    3605304,
    3327965,
    3347149,
    3320002,
    3339695,
    3334130,
    3328523,
    3353179,
    3350816,
    3332440,
    3334039,
    3336455,
    3605525,
    3390869,
    2495839,
    3544765,
    3673693,
    3665455,
    3601761,
    3665837,
    3350451,
    3566383,
    2558247,
    3596614,
    3337683,
    3555214,
    3320108,
    3352233,
    3670228,
    3333973,
    3662144,
    3375120,
    3355565,
    3489146,
    3330138,
    3531954,
    3326457,
    3532977,
    3339330,
    3352746,
    3617826,
    3327218,
    3350054,
    3642117,
    3470030,
    3336753,
    3337144,
    3544041,
    3666514,
    3350374,
    3350788,
    3333052,
    3621877,
    3664259,
    3518138,
    3324020,
    3045845,
    3357003,
    3399601,
    3666083,
    3342252,
    3335319,
    3507585,
    3569350,
    3356726,
    3611300,
    3338798,
    2815022,
    3354714,
    3338175,
    3326723,
    3334853,
    3348662,
    3365457,
    3465223,
    3643499,
    3371152,
    3325224,
    3329157,
    3375186,
    3332862,
    3471741,
    3342669,
    3338970,
    3358239,
];

$request = new GallerySearchResultStatRequest('demybus', 'hottmovs.com', 'flasher', $ids);
$request->withLimitOffset(100, 10);
$response = $service->getStats($request);

foreach ($response->walkItems() as $index => $thumbnailStat) {
    echo sprintf('%d. %d %d/%d=%.4f%s', $index, $thumbnailStat->getId(), $thumbnailStat->getClicks(), $thumbnailStat->getViews(), $thumbnailStat->getCtr(), PHP_EOL);
}

$query = 'flasher';


